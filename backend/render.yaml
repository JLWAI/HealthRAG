# Render.com Blueprint for HealthRAG Backend API
# Deploy with: https://dashboard.render.com/select-repo
# Docs: https://render.com/docs/blueprint-spec

services:
  - type: web
    name: healthrag-api
    runtime: docker
    plan: free  # Change to 'starter' ($7/mo) for production
    region: oregon  # Closest to West Coast users
    branch: main
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend

    # Environment variables
    envVars:
      - key: ENVIRONMENT
        value: production

      - key: API_HOST
        value: 0.0.0.0

      - key: API_PORT
        value: 8000

      # CRITICAL: Set these in Render dashboard (do NOT commit secrets)
      - key: SUPABASE_URL
        sync: false  # Must set manually in dashboard

      - key: SUPABASE_KEY
        sync: false  # Must set manually in dashboard

      - key: SUPABASE_SERVICE_KEY
        sync: false  # Must set manually in dashboard

      - key: DATABASE_URL
        fromDatabase:
          name: healthrag-db
          property: connectionString

      - key: JWT_SECRET_KEY
        generateValue: true  # Auto-generated secure random key

      - key: JWT_ALGORITHM
        value: HS256

      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: 15

      - key: CORS_ORIGINS
        value: "http://localhost:3000,https://healthrag.app"  # Update with your frontend URL

      # Optional: USDA FDC API key (for food search)
      - key: USDA_FDC_API_KEY
        sync: false  # Set manually if using USDA FDC integration

    # Health check
    healthCheckPath: /health

    # Auto-deploy on git push
    autoDeploy: true

# PostgreSQL database
databases:
  - name: healthrag-db
    databaseName: healthrag
    user: healthrag
    plan: free  # Change to 'starter' for production (7-day retention)
    region: oregon
    ipAllowList: []  # Empty = allow all IPs (secure with Supabase RLS)
